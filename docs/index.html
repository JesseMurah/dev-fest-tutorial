<!doctype html>

<html>
    <head>
        <meta
            name="viewport"
            content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes"
        />
        <meta name="theme-color" content="#4F7DC9" />
        <meta charset="UTF-8" />
        <title>Google DevFest Tamale - Genkit Hands-on Workshop</title>
        <link
            rel="stylesheet"
            href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono"
        />
        <link
            rel="stylesheet"
            href="//fonts.googleapis.com/icon?family=Material+Icons"
        />
        <link
            rel="stylesheet"
            href="https://storage.googleapis.com/claat-public/codelab-elements.css"
        />
        <style>
            .success {
                color: #1e8e3e;
            }
            .error {
                color: red;
            }
        </style>
    </head>
    <body>
        <google-codelab-analytics
            gaid="UA-49880327-14"
            ga4id=""
        ></google-codelab-analytics>
        <google-codelab
            codelab-gaid=""
            codelab-ga4id=""
            id="docs"
            title="Google DevFest Tamale - Genkit Hands-on Workshop"
            environment="web"
        >
            <google-codelab-step label="Overview" duration="0">
                <p>
                    Welcome to the Workshop! In this hands-on codelab, we are
                    moving beyond simple chatbots. You will learn how to build
                    production-ready AI applications using
                    <strong>Firebase Genkit</strong>. We will build a "GitHub
                    Roaster"‚Äîan application that doesn't just "chat," but
                    actively fetches data, analyzes code patterns, and generates
                    witty, context-aware commentary.
                </p>

                <p><strong>What you'll learn:</strong></p>
                <ul>
                    <li>
                        Initialize Genkit: Configure the framework with Google
                        AI (Gemini).
                    </li>
                    <li>
                        Enforce Type Safety: Use Zod schemas to ensure your AI's
                        inputs and outputs are structured and predictable.
                    </li>
                    <li>
                        Bridge the Gap: Build custom Tools that allow the AI to
                        fetch real-time data from the GitHub API.
                    </li>
                    <li>
                        Orchestrate Flows: Chain multiple operations (fetching ‚Üí
                        analyzing ‚Üí generating) into a cohesive logic flow.
                    </li>
                    <li>
                        Stream Results: Implement real-time text streaming for a
                        snappy user experience.
                    </li>
                </ul>

                <p><strong>What you'll build:</strong></p>
                <p>
                    We are building a tool that takes a GitHub username,
                    accesses their public API data, and uses Google's Gemini
                    model to "roast" (playfully critique) their coding habits.
                </p>

                <p>The Architecture:</p>
                <p>
                    Input: User provides a GitHub Username. Tool Execution:
                    Genkit calls a custom tool to fetch repositories and commit
                    history. LLM Processing: Gemini analyzes the JSON data
                    against a "Roast Persona". Output: A streamed, witty
                    response.
                </p>

                <p><strong>Prerequisites:</strong></p>
                <ul>
                    <li>Basic knowledge of TypeScript/JavaScript</li>
                    <li>Familiarity with REST APIs</li>
                    <li>A GitHub account</li>
                    <li>A Google account for AI Studio access</li>
                </ul>
                <p>Duration: 45-60 minutes</p>
            </google-codelab-step>

            <google-codelab-step
                label="Import the Project into Firebase Studio"
                duration="0"
            >
                <ol type="1">
                    <li>
                        Open
                        <a href="https://firebase.studio/" target="_blank"
                            >Firebase Studio</a
                        >
                    </li>
                    <li>Click <strong>Try Firebase Studio</strong></li>
                    <li>Click <strong>Import Repo</strong></li>
                    <li>
                        Paste this repo link:<br /><code
                            >https://github.com/JesseMurah/dev-fest-tutorial.git</code
                        >
                    </li>
                    <li>Name the workspace <strong>genkit-starter</strong></li>
                    <li>Click <strong>Import</strong></li>
                </ol>
                <p>
                    <a href="images/firebase_studio.gif" target="_blank"
                        ><img
                            alt="Importing Repo into Firebase Studio"
                            src="images/firebase_studio.gif"
                    /></a>
                </p>
            </google-codelab-step>

            <google-codelab-step
                label="Get Your Google AI Studio API Key"
                duration="0"
            >
                <ol type="1">
                    <li>
                        Open
                        <a href="https://aistudio.google.com/" target="_blank"
                            >Google AI Studio</a
                        >
                    </li>
                    <li>Generate an API Key (any project is fine)</li>
                    <li>Copy the API key</li>
                </ol>
                <p>
                    <img
                        alt="Getting API Key from Google AI Studio"
                        src="images/ai_studio.gif"
                    />
                </p>
            </google-codelab-step>

            <google-codelab-step
                label="Add the API Key to Your Project"
                duration="0"
            >
                <ol type="1">
                    <li>
                        In Firebase Studio, open the
                        <strong>dev.nix</strong> file inside the
                        <strong>.idx</strong> folder.
                    </li>
                    <li>
                        Find the <code>env</code> section and add your API key:
                        <pre><code language="language-nix" class="language-nix">env = {
  # TODO Get an API key from https://g.co/ai/idxGetGeminiKey
  GOOGLE_GENAI_API_KEY = "AI STUDIO KEY HERE";
};</code></pre>
                    </li>
                    <p>
                        <img
                            alt="Adding API Key to dev.nix"
                            src="images/add_gemini_key.jpeg"
                        />
                    </p>
                    <li>Save the file.</li>
                </ol>
                <p>
                    Note: Rebuild the environment when prompted (should appear
                    at the bottom right after saving the API key).
                </p>
                <p>
                    <img
                        alt="Rebuilding Environment in Firebase Studio"
                        src="images/rebuild-environment.jpeg"
                    />
                </p>
            </google-codelab-step>

            <google-codelab-step
                label="Step 4: Install Dependencies"
                duration="0"
            >
                <p>In the terminal, run:</p>
                <pre><code language="language-sh" class="language-sh">npm install</code></pre>
                <p>
                    <a href="images/npm_install.gif" target="_blank"
                        ><img
                            alt="Installing Dependencies"
                            src="images/npm_install.gif"
                    /></a>
                </p>
            </google-codelab-step>

            <google-codelab-step
                label="Set Up Imports and Initialize Genkit"
                duration="0"
            >
                <p>
                    First, let's examine how we import and initialize Genkit
                    with the Google AI plugin.
                </p>
                <ol type="1">
                    <li>
                        Open the <code>index.ts</code> file in your workspace
                    </li>
                    <li>
                        Review the following imports and initialization code:
                        <pre><code language="language-ts" class="language-ts">import { gemini20Flash, googleAI } from '@genkit-ai/googleai';
import { genkit, z } from 'genkit';

// Initialize Genkit with the Google AI plugin and set a default model.
const ai = genkit({
  plugins: [googleAI()],
  model: gemini20Flash,
});</code></pre>
                        <p>
                            Note: This setup gives us access to Google's Gemini
                            models through Genkit's unified AI interface.
                        </p>
                    </li>
                </ol>
            </google-codelab-step>

            <google-codelab-step
                label="Define Data Schemas with Zod"
                duration="0"
            >
                <p>
                    Next, we'll create type-safe data structures using Zod
                    schemas. These ensure our data from the GitHub API is
                    properly validated.
                </p>
                <ol type="1">
                    <li>
                        Add the repository schema for GitHub repository data:
                        <pre><code language="language-ts" class="language-ts">// Zod schema for a GitHub repository's relevant data.
const repoSchema = z.object({
  name: z.string(),
  language: z.string().nullable(),
  pushed_at: z.string(),
  stargazers_count: z.number(),
  forks: z.number(),
});</code></pre>
                    </li>
                    <li>
                        Add the GitHub event schema for commit data:
                        <pre><code language="language-ts" class="language-ts">// Zod schema for a single GitHub event.
const githubEventSchema = z.object({
  id: z.string(),
  type: z.string(),
  repo: z.object({
    id: z.number(),
    name: z.string(),
    url: z.string(),
  }),
  payload: z.object({
    commits: z
      .array(
        z.object({
          sha: z.string(),
          author: z.object({
            email: z.string(),
            name: z.string(),
          }),
          message: z.string(),
          distinct: z.boolean(),
          url: z.string(),
        }),
      )
      .optional(),
  }),
});

// Zod schema for an array of GitHub events.
const githubEventsArraySchema = z.array(githubEventSchema);</code></pre>
                        <p>
                            Note: Zod schemas provide runtime type validation
                            and excellent TypeScript integration, ensuring data
                            integrity throughout your application.
                        </p>
                    </li>
                </ol>
            </google-codelab-step>

            <google-codelab-step
                label="Create the GitHub Repositories Tool"
                duration="0"
            >
                <p>
                    Now we'll create our first Genkit tool that fetches GitHub
                    repository data.
                </p>
                <p>Add the <code>fetchGithubRepos</code> tool:</p>
                <pre><code language="language-ts" class="language-ts">const fetchGithubRepos = ai.defineTool(
  {
    name: 'fetchGithubRepos',
    description:
      'Fetches a list of public repositories for a given GitHub username sorted by pushed date (recently updated).',
    // Input validation using Zod
    inputSchema: z.object({ username: z.string() }),
    // Output validation using Zod
    outputSchema: z.array(repoSchema),
  },
  async ({ username }) => {
    console.log(`Fetching repos for ${username}`);
    const response = await fetch(
      // Fetch the last 15 repos sorted by pushed date
      `https://api.github.com/users/${username}/repos?sort=pushed&per_page=15`,
      {
        headers: {
          Accept: 'application/vnd.github.v3+json',
          'User-Agent': 'Genkit-Repo-Roaster-Agent', // GitHub requires a User-Agent
        },
      },
    );

    if (!response.ok) {
      throw new Error(`Failed to fetch repos from GitHub: ${response.statusText}`);
    }

    const repos = await response.json();
    const reposParsed = z.array(repoSchema).parse(repos);

    // Return only the properties we need
    return reposParsed.map((repo) => ({
      name: repo.name,
      language: repo.language,
      pushed_at: repo.pushed_at,
      stargazers_count: repo.stargazers_count,
      forks: repo.forks,
    }));
  },
);</code></pre>
                <p>
                    Note: <strong>Important</strong>: Tools are functions that
                    the AI can call autonomously to gather information. The AI
                    decides when and how to use them based on the tool's
                    description.
                </p>
            </google-codelab-step>

            <google-codelab-step
                label="Create the Commit Messages Tool"
                duration="0"
            >
                <p>
                    Our second tool will fetch commit messages from a user's
                    recent GitHub activity.
                </p>
                <p>Add the <code>fetchCommitMessages</code> tool:</p>
                <pre><code language="language-ts" class="language-ts">const fetchCommitMessages = ai.defineTool(
  {
    name: 'fetchCommitMessages',
    description: 'Fetches commit messages from the last 100 events of a GitHub user.',
    inputSchema: z.object({
      owner: z.string(),
    }),
    outputSchema: z.array(z.string()),
  },
  async ({ owner }) => {
    const response = await fetch(
      `https://api.github.com/users/${owner}/events?per_page=100`, // Fetch the last 100 events
      {
        headers: {
          Accept: 'application/vnd.github.v3+json',
          'User-Agent': 'Genkit-Repo-Roaster-Agent',
        },
      },
    );

    if (!response.ok) {
      throw new Error(`Failed to fetch commit messages from GitHub: ${response.statusText}`);
    }

    const commits = await response.json();
    const commitsParsed = githubEventsArraySchema.parse(commits);

    return (
      commitsParsed
        // Filter for PushEvent type and extract commit messages
        .filter((event) => event.type === 'PushEvent')
        .map((commit) => commit.payload.commits?.map((c) => c.message))
        .flat()
        .filter((commit) => commit !== undefined) as string[]
    );
  },
);</code></pre>
                <p>
                    Note: This tool extracts commit messages from GitHub's
                    events API, giving the AI insight into a developer's commit
                    history.
                </p>
            </google-codelab-step>

            <google-codelab-step label="Create the Main Flow" duration="0">
                <p>
                    Finally, we'll create the main flow that orchestrates
                    everything together. Add the
                    <code>githubGrillerFlow</code> that combines our tools with
                    AI generation:
                </p>
                <pre><code language="language-ts" class="language-ts">const githubGrillerFlow = ai.defineFlow(
  {
    name: 'githubGrillerFlow',
    inputSchema: z.object({
      username: z.string(),
    }),
    outputSchema: z.string(),
  },
  async ({ username }, streamCallback) => {
    const { response, stream } = ai.generateStream({
      prompt: `
        You are a witty, sarcastic, and expert code reviewer. Your name is "Ripper - The Roast master".
        Your task is to write a short, funny roast of a developer based on their public GitHub repositories.
        Be playful and clever, not truly mean (but also, don't hold back).

        Here's the username for the user "${username}".

        Using the provided tools, you will fetch their GitHub repositories and commit messages,
        and then roast them based on their activity.

        Roast them! Consider these angles:
        - Too many unfinished projects (look at the 'pushed_at' dates).
        - Sticking to only one language (e.g., "Ah, another JavaScript connoisseur").
        - Weird or unoriginal repository names.
        - A graveyard of forked repos with no original work.
        - A complete lack of stars.

        You only have one task: roast the developer based on their GitHub activity and nothing else.
        Return the roast as a single string, no other text or explanation needed.
      `,
      /* Please note the tools being used here are crucial for fetching the necessary data to inform the AI's response.

      */
      tools: [fetchGithubRepos, fetchCommitMessages],
      config: {
        temperature: 0.8, // Higher temperature for more creative responses
      },
    });

    // Stream the response back to the client
    for await (const chunk of stream) {
      streamCallback(chunk);
    }

    const { text } = await response;
    console.log({ text });
    return text;
  },
);</code></pre>
                <p>
                    Note: <strong>Flow Architecture</strong>: Flows orchestrate
                    multiple AI calls and tool usage. They can stream responses
                    in real-time and handle complex multi-step AI interactions.
                </p>
            </google-codelab-step>

            <google-codelab-step label="Run and Test the Project" duration="0">
                <p>
                    Now let's run the Genkit Developer UI to test our GitHub
                    Roaster application.
                </p>
                <ol type="1">
                    <li>
                        In the terminal, first check if the Genkit Development
                        UI is running.
                        <p>
                            <a href="images/run-gdu.gif" target="_blank"
                                ><img
                                    alt="Run Genkit Development UI"
                                    src="images/run-gdu.gif"
                            /></a>
                        </p>
                    </li>
                    <li>
                        If not, start the Genkit Development UI by running the
                        following command:
                        <pre><code language="language-sh" class="language-sh">npx genkit start -- npx tsx --watch index.ts</code></pre>
                    </li>
                    <li>
                        Click on the link provided in the terminal (usually
                        <code>http://localhost:4000</code>), which opens the
                        Genkit Developer UI in your browser.
                        <p>
                            <em
                                >Do not type the URL manually, as this won't
                                work, since the server is running on Firebase
                                Studio's infrastructure, not your local
                                machine.</em
                            >
                        </p>
                    </li>
                    <li>
                        In the Genkit Developer UI:
                        <ul>
                            <li>
                                Navigate to the <strong>Flows</strong> section
                            </li>
                            <li>Find the <code>githubGrillerFlow</code></li>
                            <li>Click on it to open the flow tester</li>
                        </ul>
                    </li>
                    <li>
                        Test the flow:
                        <ul>
                            <li>Enter a GitHub username in the input field</li>
                            <li>Click <strong>Run Flow</strong></li>
                            <li>
                                Watch as the AI streams its roast in real-time!
                            </li>
                        </ul>
                        <p>
                            <a
                                href="images/genkit-development-ui.gif"
                                target="_blank"
                                ><img
                                    alt="Genkit Development UI"
                                    src="images/genkit-development-ui.gif"
                            /></a>
                        </p>
                    </li>
                    <li>
                        Explore the <strong>Tools</strong> section to see how
                        individual tools work:
                        <ul>
                            <li>
                                Test <code>fetchGithubRepos</code> with
                                different usernames
                            </li>
                            <li>
                                Try <code>fetchCommitMessages</code> to see
                                commit history analysis
                            </li>
                        </ul>
                    </li>
                </ol>
                <p>
                    Note: <strong>Developer UI Features</strong>: The Genkit
                    Developer UI provides powerful debugging capabilities,
                    allowing you to test flows, inspect tool outputs, and
                    monitor AI interactions in real-time.
                </p>
                <p>
                    Note: <strong>Rate Limiting</strong>: Be mindful of GitHub's
                    API rate limits when testing. Unauthenticated requests are
                    limited to 60 per hour per IP address.
                </p>
            </google-codelab-step>

            <google-codelab-step label="Congratulations!" duration="0">
                <p>
                    You've successfully built an AI-powered GitHub analysis
                    application using Firebase Genkit!
                </p>
                <p><strong>What you accomplished:</strong></p>
                <ul>
                    <li>‚úÖ Set up Genkit with Google AI integration</li>
                    <li>‚úÖ Created type-safe data schemas with Zod</li>
                    <li>
                        ‚úÖ Built custom AI tools for external API integration
                    </li>
                    <li>‚úÖ Implemented a streaming AI flow</li>
                    <li>
                        ‚úÖ Tested your application with the Genkit Developer UI
                    </li>
                </ul>
                <p><strong>Next Steps:</strong></p>
                <ul>
                    <li>
                        Try modifying the roast prompt for different
                        personalities
                    </li>
                    <li>
                        Add more GitHub API endpoints like Github Profile Info,
                        so it can use the user's name and bio in the roast
                    </li>
                    <li>
                        Add more GitHub API endpoints (issues, pull requests,
                        etc.)
                    </li>
                    <li>Deploy your application to Firebase Functions</li>
                    <li>Explore other Genkit plugins and models</li>
                </ul>
            </google-codelab-step>

            <google-codelab-step
                label="Resources and Connect With Us"
                duration="0"
            >
                <h2 is-upgraded>üìö Workshop Resources</h2>
                <ul>
                    <li>
                        <strong>GitHub Repository</strong>:
                        <a
                            href="https://github.com/JesseMurah/dev-fest-tutorial"
                            target="_blank"
                            >dev-fest-tutorial</a
                        >
                    </li>
                    <li>
                        <strong>Firebase Genkit Documentation</strong>:
                        <a
                            href="https://firebase.google.com/docs/genkit"
                            target="_blank"
                            >Official Docs</a
                        >
                    </li>
                    <li>
                        <strong>Google AI Studio</strong>:
                        <a href="https://aistudio.google.com/" target="_blank"
                            >aistudio.google.com</a
                        >
                    </li>
                </ul>

                <h2 is-upgraded>ü§ù Connect With the Authors</h2>
                <p><strong>Jesse Murah</strong></p>
                <ul>
                    <li>
                        üíº LinkedIn:
                        <a
                            href="https://linkedin.com/in/JesseMurah"
                            target="_blank"
                            >Jesse Murah</a
                        >
                    </li>
                    <li>
                        üêô GitHub:
                        <a href="https://github.com/JesseMurah" target="_blank"
                            >@JesseMurah</a
                        >
                    </li>
                </ul>

                <hr />

                <p><strong>Credit to Unstacked Labs.</strong></p>
                <p>Have Fun! üöÄ</p>
            </google-codelab-step>
        </google-codelab>

        <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
        <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
        <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
        <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
        <script src="//support.google.com/inapp/api.js"></script>
    </body>
</html>
